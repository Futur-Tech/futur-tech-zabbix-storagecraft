<?xml version="1.0" encoding="UTF-8"?>
<zabbix_export>
    <version>5.0</version>
    <date>2021-09-12T12:26:31Z</date>
    <groups>
        <group>
            <name>Templates/Futur-Tech/Applications</name>
        </group>
    </groups>
    <templates>
        <template>
            <template>Template Futur-Tech App StorageCraft</template>
            <name>Template Futur-Tech App StorageCraft</name>
            <description>https://github.com/Futur-Tech/futur-tech-zabbix-storagecraft</description>
            <groups>
                <group>
                    <name>Templates/Futur-Tech/Applications</name>
                </group>
            </groups>
            <applications>
                <application>
                    <name>StorageCraft Dashboard</name>
                </application>
                <application>
                    <name>StorageCraft ImageManager</name>
                </application>
                <application>
                    <name>StorageCraft ShadowProtectSPX</name>
                </application>
            </applications>
            <items>
                <item>
                    <name>ShadowProtectSPX Event Log</name>
                    <type>ZABBIX_ACTIVE</type>
                    <key>eventlog[Application,,,ShadowProtectSPX,,,skip]</key>
                    <delay>5m</delay>
                    <trends>0</trends>
                    <value_type>LOG</value_type>
                    <applications>
                        <application>
                            <name>StorageCraft ShadowProtectSPX</name>
                        </application>
                    </applications>
                    <triggers>
                        <trigger>
                            <expression>{regexp(Backup \&quot;[^\&quot;]+\&quot; on,#1)}=0 and {logseverity()}=9</expression>
                            <recovery_mode>NONE</recovery_mode>
                            <name>Critical Error in ShadowProtectSPX Event Log</name>
                            <opdata>{{ITEM.VALUE}.regsub(&quot;([\s\S]*)&quot;, \1)}</opdata>
                            <priority>HIGH</priority>
                            <description>This trigger need to be manually closed.</description>
                            <type>MULTIPLE</type>
                            <manual_close>YES</manual_close>
                        </trigger>
                        <trigger>
                            <expression>{regexp(Backup \&quot;[^\&quot;]+\&quot; on,#1)}=0 and {logseverity()}=4</expression>
                            <recovery_mode>NONE</recovery_mode>
                            <name>Error in ShadowProtectSPX Event Log</name>
                            <opdata>{{ITEM.VALUE}.regsub(&quot;([\s\S]*)&quot;, \1)}</opdata>
                            <priority>AVERAGE</priority>
                            <description>This trigger need to be manually closed.</description>
                            <type>MULTIPLE</type>
                            <manual_close>YES</manual_close>
                        </trigger>
                        <trigger>
                            <expression>{regexp(Backup \&quot;[^\&quot;]+\&quot; on,#1)}=0 and {logseverity()}=1</expression>
                            <recovery_mode>NONE</recovery_mode>
                            <name>Information in ShadowProtectSPX Event Log</name>
                            <opdata>{{ITEM.VALUE}.regsub(&quot;([\s\S]*)&quot;, \1)}</opdata>
                            <status>DISABLED</status>
                            <priority>INFO</priority>
                            <description>This trigger need to be manually closed.</description>
                            <type>MULTIPLE</type>
                            <manual_close>YES</manual_close>
                        </trigger>
                        <trigger>
                            <expression>{regexp(Backup \&quot;[^\&quot;]+\&quot; on,#1)}=0 and {logseverity()}=2</expression>
                            <recovery_mode>NONE</recovery_mode>
                            <name>Warning in ShadowProtectSPX Event Log</name>
                            <opdata>{{ITEM.VALUE}.regsub(&quot;([\s\S]*)&quot;, \1)}</opdata>
                            <priority>WARNING</priority>
                            <description>This trigger need to be manually closed.</description>
                            <type>MULTIPLE</type>
                            <manual_close>YES</manual_close>
                        </trigger>
                    </triggers>
                </item>
                <item>
                    <name>ImageManager Event Log</name>
                    <type>ZABBIX_ACTIVE</type>
                    <key>eventlog[Application,,,StorageCraft ImageManager,,,skip]</key>
                    <delay>5m</delay>
                    <trends>0</trends>
                    <value_type>LOG</value_type>
                    <applications>
                        <application>
                            <name>StorageCraft ImageManager</name>
                        </application>
                    </applications>
                    <triggers>
                        <trigger>
                            <expression>{regexp(\\.+\\.+\\,#1)}=0 and {logseverity()}=9</expression>
                            <recovery_mode>NONE</recovery_mode>
                            <name>Critical Error in ImageManager Event Log</name>
                            <opdata>{{ITEM.VALUE}.regsub(&quot;([\s\S]*)&quot;, \1)}</opdata>
                            <priority>HIGH</priority>
                            <description>This trigger need to be manually closed.</description>
                            <type>MULTIPLE</type>
                            <manual_close>YES</manual_close>
                        </trigger>
                        <trigger>
                            <expression>{regexp(\\.+\\.+\\,#1)}=0 and {logseverity()}=4</expression>
                            <recovery_mode>NONE</recovery_mode>
                            <name>Error in ImageManager Event Log</name>
                            <opdata>{{ITEM.VALUE}.regsub(&quot;([\s\S]*)&quot;, \1)}</opdata>
                            <priority>AVERAGE</priority>
                            <description>This trigger need to be manually closed.</description>
                            <type>MULTIPLE</type>
                            <manual_close>YES</manual_close>
                        </trigger>
                        <trigger>
                            <expression>{regexp(\\.+\\.+\\,#1)}=0 and {logseverity()}=1</expression>
                            <recovery_mode>NONE</recovery_mode>
                            <name>Information in ImageManager Event Log</name>
                            <opdata>{{ITEM.VALUE}.regsub(&quot;([\s\S]*)&quot;, \1)}</opdata>
                            <status>DISABLED</status>
                            <priority>INFO</priority>
                            <description>This trigger need to be manually closed.</description>
                            <type>MULTIPLE</type>
                            <manual_close>YES</manual_close>
                        </trigger>
                        <trigger>
                            <expression>{regexp(\\.+\\.+\\,#1)}=0 and {logseverity()}=2</expression>
                            <recovery_mode>NONE</recovery_mode>
                            <name>Warning in ImageManager Event Log</name>
                            <opdata>{{ITEM.VALUE}.regsub(&quot;([\s\S]*)&quot;, \1)}</opdata>
                            <priority>WARNING</priority>
                            <description>This trigger need to be manually closed.</description>
                            <type>MULTIPLE</type>
                            <manual_close>YES</manual_close>
                        </trigger>
                    </triggers>
                </item>
            </items>
            <discovery_rules>
                <discovery_rule>
                    <name>ImageManager Discovery</name>
                    <type>DEPENDENT</type>
                    <key>storagecraft.imagemanager.discovery</key>
                    <delay>0</delay>
                    <item_prototypes>
                        <item_prototype>
                            <name>{#MACHINE_UPPER} Collapse [{#VOL}] Age</name>
                            <type>CALCULATED</type>
                            <key>imagemanager.collapse.age[{#MACHINE},{#VOL}]</key>
                            <delay>5m</delay>
                            <units>uptime</units>
                            <params>now(&quot;wmi.get[root\cimv2,SELECT TimeGenerated FROM Win32_NTLogEvent WHERE (logfile='Application') AND (SourceName='StorageCraft ImageManager') AND (EventCode=1120) AND (Message LIKE '{#PATH_ESC}\\{#VOL}%.spi')]&quot;)-last(&quot;wmi.get[root\cimv2,SELECT TimeGenerated FROM Win32_NTLogEvent WHERE (logfile='Application') AND (SourceName='StorageCraft ImageManager') AND (EventCode=1120) AND (Message LIKE '{#PATH_ESC}\\{#VOL}%.spi')]&quot;)</params>
                            <applications>
                                <application>
                                    <name>StorageCraft Dashboard</name>
                                </application>
                                <application>
                                    <name>StorageCraft ImageManager</name>
                                </application>
                            </applications>
                            <trigger_prototypes>
                                <trigger_prototype>
                                    <expression>{last()}&gt;129600</expression>
                                    <name>No ImageManager Collapse of {#MACHINE_UPPER} [{#VOL}] for more than 36h</name>
                                    <opdata>Last collapse age: {ITEM.LASTVALUE1}</opdata>
                                    <priority>WARNING</priority>
                                    <dependencies>
                                        <dependency>
                                            <name>No ImageManager Collapse of {#MACHINE_UPPER} [{#VOL}] for more than 72h</name>
                                            <expression>{Template Futur-Tech App StorageCraft:imagemanager.collapse.age[{#MACHINE},{#VOL}].last()}&gt;259200</expression>
                                        </dependency>
                                    </dependencies>
                                </trigger_prototype>
                                <trigger_prototype>
                                    <expression>{last()}&gt;259200</expression>
                                    <name>No ImageManager Collapse of {#MACHINE_UPPER} [{#VOL}] for more than 72h</name>
                                    <opdata>Last collapse age: {ITEM.LASTVALUE1}</opdata>
                                    <priority>HIGH</priority>
                                </trigger_prototype>
                            </trigger_prototypes>
                        </item_prototype>
                        <item_prototype>
                            <name>{#MACHINE_UPPER} Collapse [{#VOL}] Success</name>
                            <type>ZABBIX_ACTIVE</type>
                            <key>wmi.get[root\cimv2,SELECT TimeGenerated FROM Win32_NTLogEvent WHERE (logfile='Application') AND (SourceName='StorageCraft ImageManager') AND (EventCode=1120) AND (Message LIKE '{#PATH_ESC}\\{#VOL}%.spi')]</key>
                            <delay>15m</delay>
                            <units>unixtime</units>
                            <applications>
                                <application>
                                    <name>StorageCraft ImageManager</name>
                                </application>
                            </applications>
                            <preprocessing>
                                <step>
                                    <type>JAVASCRIPT</type>
                                    <params>var match = /^(\d+)\.\d+-\d+$/gi.exec(value);
var ts = new Date();

ts.setUTCFullYear(match[1].substring(0,4));
ts.setUTCMonth(match[1].substring(4,6)-1);
ts.setUTCDate(match[1].substring(6,8));
ts.setUTCHours(match[1].substring(8,10));
ts.setUTCMinutes(match[1].substring(10,12));
ts.setUTCSeconds(match[1].substring(12,14));
ts.setUTCMilliseconds(0);

return ts.valueOf() / 1000;</params>
                                </step>
                                <step>
                                    <type>DISCARD_UNCHANGED_HEARTBEAT</type>
                                    <params>1d</params>
                                </step>
                            </preprocessing>
                        </item_prototype>
                    </item_prototypes>
                    <trigger_prototypes>
                        <trigger_prototype>
                            <expression>{Template Futur-Tech App StorageCraft:eventlog[Application,,,StorageCraft ImageManager,,,skip].regexp({#PATH_ESC},#1)}=1&#13;
and &#13;
    ({Template Futur-Tech App StorageCraft:eventlog[Application,,,StorageCraft ImageManager,,,skip].regexp([\W]{#VOL}-.+\.spi,#1)}=1 &#13;
    or&#13;
    {Template Futur-Tech App StorageCraft:eventlog[Application,,,StorageCraft ImageManager,,,skip].regexp(_VOL-b\d+-.+\.spi,#1)}=0) &#13;
and {Template Futur-Tech App StorageCraft:imagemanager.collapse.age[{#MACHINE},{#VOL}].last()}&gt;0&#13;
and {Template Futur-Tech App StorageCraft:eventlog[Application,,,StorageCraft ImageManager,,,skip].logseverity()}=9</expression>
                            <recovery_mode>RECOVERY_EXPRESSION</recovery_mode>
                            <recovery_expression>{Template Futur-Tech App StorageCraft:eventlog[Application,,,StorageCraft ImageManager,,,skip].regexp(^{#PATH_ESC}\\{#VOL}-.+\.spi$,#1)}=1&#13;
and {Template Futur-Tech App StorageCraft:eventlog[Application,,,StorageCraft ImageManager,,,skip].logseverity()}=1&#13;
and {Template Futur-Tech App StorageCraft:eventlog[Application,,,ShadowProtectSPX,,,skip].logeventid(1120)}=1</recovery_expression>
                            <name>Critical Error in ImageManager Event Log for {#MACHINE_UPPER} [{#VOL}]</name>
                            <opdata>Last collapse age: {ITEM.LASTVALUE4}</opdata>
                            <priority>HIGH</priority>
                        </trigger_prototype>
                        <trigger_prototype>
                            <expression>{Template Futur-Tech App StorageCraft:eventlog[Application,,,StorageCraft ImageManager,,,skip].regexp({#PATH_ESC},#1)}=1&#13;
and &#13;
    ({Template Futur-Tech App StorageCraft:eventlog[Application,,,StorageCraft ImageManager,,,skip].regexp([\W]{#VOL}-.+\.spi,#1)}=1 &#13;
    or&#13;
    {Template Futur-Tech App StorageCraft:eventlog[Application,,,StorageCraft ImageManager,,,skip].regexp(_VOL-b\d+-.+\.spi,#1)}=0) &#13;
and {Template Futur-Tech App StorageCraft:imagemanager.collapse.age[{#MACHINE},{#VOL}].last()}&gt;0&#13;
and {Template Futur-Tech App StorageCraft:eventlog[Application,,,StorageCraft ImageManager,,,skip].logseverity()}=4</expression>
                            <recovery_mode>RECOVERY_EXPRESSION</recovery_mode>
                            <recovery_expression>{Template Futur-Tech App StorageCraft:eventlog[Application,,,StorageCraft ImageManager,,,skip].regexp(^{#PATH_ESC}\\{#VOL}-.+\.spi$,#1)}=1&#13;
and {Template Futur-Tech App StorageCraft:eventlog[Application,,,StorageCraft ImageManager,,,skip].logseverity()}=1&#13;
and {Template Futur-Tech App StorageCraft:eventlog[Application,,,ShadowProtectSPX,,,skip].logeventid(1120)}=1</recovery_expression>
                            <name>Error in ImageManager Event Log for {#MACHINE_UPPER} [{#VOL}]</name>
                            <opdata>Last collapse age: {ITEM.LASTVALUE4}</opdata>
                            <priority>AVERAGE</priority>
                            <dependencies>
                                <dependency>
                                    <name>Critical Error in ImageManager Event Log for {#MACHINE_UPPER} [{#VOL}]</name>
                                    <expression>{Template Futur-Tech App StorageCraft:eventlog[Application,,,StorageCraft ImageManager,,,skip].regexp({#PATH_ESC},#1)}=1&#13;
and &#13;
    ({Template Futur-Tech App StorageCraft:eventlog[Application,,,StorageCraft ImageManager,,,skip].regexp([\W]{#VOL}-.+\.spi,#1)}=1 &#13;
    or&#13;
    {Template Futur-Tech App StorageCraft:eventlog[Application,,,StorageCraft ImageManager,,,skip].regexp(_VOL-b\d+-.+\.spi,#1)}=0) &#13;
and {Template Futur-Tech App StorageCraft:imagemanager.collapse.age[{#MACHINE},{#VOL}].last()}&gt;0&#13;
and {Template Futur-Tech App StorageCraft:eventlog[Application,,,StorageCraft ImageManager,,,skip].logseverity()}=9</expression>
                                    <recovery_expression>{Template Futur-Tech App StorageCraft:eventlog[Application,,,StorageCraft ImageManager,,,skip].regexp(^{#PATH_ESC}\\{#VOL}-.+\.spi$,#1)}=1&#13;
and {Template Futur-Tech App StorageCraft:eventlog[Application,,,StorageCraft ImageManager,,,skip].logseverity()}=1&#13;
and {Template Futur-Tech App StorageCraft:eventlog[Application,,,ShadowProtectSPX,,,skip].logeventid(1120)}=1</recovery_expression>
                                </dependency>
                            </dependencies>
                        </trigger_prototype>
                        <trigger_prototype>
                            <expression>{Template Futur-Tech App StorageCraft:eventlog[Application,,,StorageCraft ImageManager,,,skip].regexp({#PATH_ESC},#1)}=1&#13;
and &#13;
    ({Template Futur-Tech App StorageCraft:eventlog[Application,,,StorageCraft ImageManager,,,skip].regexp([\W]{#VOL}-.+\.spi,#1)}=1 &#13;
    or&#13;
    {Template Futur-Tech App StorageCraft:eventlog[Application,,,StorageCraft ImageManager,,,skip].regexp(_VOL-b\d+-.+\.spi,#1)}=0) &#13;
and {Template Futur-Tech App StorageCraft:imagemanager.collapse.age[{#MACHINE},{#VOL}].last()}&gt;0&#13;
and {Template Futur-Tech App StorageCraft:eventlog[Application,,,StorageCraft ImageManager,,,skip].logseverity()}=2</expression>
                            <recovery_mode>RECOVERY_EXPRESSION</recovery_mode>
                            <recovery_expression>{Template Futur-Tech App StorageCraft:eventlog[Application,,,StorageCraft ImageManager,,,skip].regexp(^{#PATH_ESC}\\{#VOL}-.+\.spi$,#1)}=1&#13;
and {Template Futur-Tech App StorageCraft:eventlog[Application,,,StorageCraft ImageManager,,,skip].logseverity()}=1&#13;
and {Template Futur-Tech App StorageCraft:eventlog[Application,,,ShadowProtectSPX,,,skip].logeventid(1120)}=1</recovery_expression>
                            <name>Warning in ImageManager Event Log for {#MACHINE_UPPER} [{#VOL}]</name>
                            <opdata>Last collapse age: {ITEM.LASTVALUE4}</opdata>
                            <priority>WARNING</priority>
                            <dependencies>
                                <dependency>
                                    <name>Critical Error in ImageManager Event Log for {#MACHINE_UPPER} [{#VOL}]</name>
                                    <expression>{Template Futur-Tech App StorageCraft:eventlog[Application,,,StorageCraft ImageManager,,,skip].regexp({#PATH_ESC},#1)}=1&#13;
and &#13;
    ({Template Futur-Tech App StorageCraft:eventlog[Application,,,StorageCraft ImageManager,,,skip].regexp([\W]{#VOL}-.+\.spi,#1)}=1 &#13;
    or&#13;
    {Template Futur-Tech App StorageCraft:eventlog[Application,,,StorageCraft ImageManager,,,skip].regexp(_VOL-b\d+-.+\.spi,#1)}=0) &#13;
and {Template Futur-Tech App StorageCraft:imagemanager.collapse.age[{#MACHINE},{#VOL}].last()}&gt;0&#13;
and {Template Futur-Tech App StorageCraft:eventlog[Application,,,StorageCraft ImageManager,,,skip].logseverity()}=9</expression>
                                    <recovery_expression>{Template Futur-Tech App StorageCraft:eventlog[Application,,,StorageCraft ImageManager,,,skip].regexp(^{#PATH_ESC}\\{#VOL}-.+\.spi$,#1)}=1&#13;
and {Template Futur-Tech App StorageCraft:eventlog[Application,,,StorageCraft ImageManager,,,skip].logseverity()}=1&#13;
and {Template Futur-Tech App StorageCraft:eventlog[Application,,,ShadowProtectSPX,,,skip].logeventid(1120)}=1</recovery_expression>
                                </dependency>
                                <dependency>
                                    <name>Error in ImageManager Event Log for {#MACHINE_UPPER} [{#VOL}]</name>
                                    <expression>{Template Futur-Tech App StorageCraft:eventlog[Application,,,StorageCraft ImageManager,,,skip].regexp({#PATH_ESC},#1)}=1&#13;
and &#13;
    ({Template Futur-Tech App StorageCraft:eventlog[Application,,,StorageCraft ImageManager,,,skip].regexp([\W]{#VOL}-.+\.spi,#1)}=1 &#13;
    or&#13;
    {Template Futur-Tech App StorageCraft:eventlog[Application,,,StorageCraft ImageManager,,,skip].regexp(_VOL-b\d+-.+\.spi,#1)}=0) &#13;
and {Template Futur-Tech App StorageCraft:imagemanager.collapse.age[{#MACHINE},{#VOL}].last()}&gt;0&#13;
and {Template Futur-Tech App StorageCraft:eventlog[Application,,,StorageCraft ImageManager,,,skip].logseverity()}=4</expression>
                                    <recovery_expression>{Template Futur-Tech App StorageCraft:eventlog[Application,,,StorageCraft ImageManager,,,skip].regexp(^{#PATH_ESC}\\{#VOL}-.+\.spi$,#1)}=1&#13;
and {Template Futur-Tech App StorageCraft:eventlog[Application,,,StorageCraft ImageManager,,,skip].logseverity()}=1&#13;
and {Template Futur-Tech App StorageCraft:eventlog[Application,,,ShadowProtectSPX,,,skip].logeventid(1120)}=1</recovery_expression>
                                </dependency>
                            </dependencies>
                        </trigger_prototype>
                    </trigger_prototypes>
                    <master_item>
                        <key>eventlog[Application,,,StorageCraft ImageManager,,,skip]</key>
                    </master_item>
                    <preprocessing>
                        <step>
                            <type>REGEX</type>
                            <params>^(\\\\[^\n\r\\]+(?:.*\\([^\n\r\\]+)\\([^\n\r\\]+)\\ft-backup|.*\\([^\n\r\\]+)\\([^\n\r\\]+)))\\([^\n\r\\]*_VOL-b\d+).+\.spi$
\0</params>
                            <error_handler>DISCARD_VALUE</error_handler>
                        </step>
                        <step>
                            <type>JAVASCRIPT</type>
                            <params>var lld = [];
var row = {};
var matches = /^(\\\\[^\n\r\\]+(?:.*\\([^\n\r\\]+)\\([^\n\r\\]+)\\ft-backup|.*\\([^\n\r\\]+)\\([^\n\r\\]+)))\\([^\n\r\\]*_VOL-b\d+).+\.spi$/gi.exec(value);
row[&quot;{#PATH}&quot;] = matches[1];
row[&quot;{#PATH_ESC}&quot;] = row[&quot;{#PATH}&quot;].replace(/\\/g,'\\\\');
if (matches[2]) {
    row[&quot;{#SITECODE}&quot;] = matches[2];
    row[&quot;{#MACHINE}&quot;] = matches[3];
} else {
    row[&quot;{#SITECODE}&quot;] = matches[4];
    row[&quot;{#MACHINE}&quot;] = matches[5];
}
row[&quot;{#MACHINE_UPPER}&quot;] = row[&quot;{#MACHINE}&quot;].toUpperCase();
row[&quot;{#VOL}&quot;] = matches[6];
lld.push(row);
return JSON.stringify(lld);</params>
                        </step>
                    </preprocessing>
                </discovery_rule>
                <discovery_rule>
                    <name>ShadowProtectSPX Discovery</name>
                    <type>DEPENDENT</type>
                    <key>storagecraft.shadowprotectspx.discovery</key>
                    <delay>0</delay>
                    <item_prototypes>
                        <item_prototype>
                            <name>{#MACHINE_UPPER} Backup [{#TASK}] Age</name>
                            <type>CALCULATED</type>
                            <key>shadowprotectspx.backup.age[{#MACHINE},{#TASK}]</key>
                            <delay>5m</delay>
                            <units>uptime</units>
                            <params>now(&quot;wmi.get[root\cimv2,SELECT TimeGenerated FROM Win32_NTLogEvent WHERE (logfile='Application') AND (SourceName='ShadowProtectSPX') AND (EventCode=3) AND (Message LIKE '%Backup \&quot;{#TASK}\&quot; on {#MACHINE} successfully finished backing up%')]&quot;)-last(&quot;wmi.get[root\cimv2,SELECT TimeGenerated FROM Win32_NTLogEvent WHERE (logfile='Application') AND (SourceName='ShadowProtectSPX') AND (EventCode=3) AND (Message LIKE '%Backup \&quot;{#TASK}\&quot; on {#MACHINE} successfully finished backing up%')]&quot;)</params>
                            <applications>
                                <application>
                                    <name>StorageCraft Dashboard</name>
                                </application>
                                <application>
                                    <name>StorageCraft ShadowProtectSPX</name>
                                </application>
                            </applications>
                            <trigger_prototypes>
                                <trigger_prototype>
                                    <expression>{last()}&gt;129600</expression>
                                    <name>No ShadowProtectSPX Backup of {#MACHINE_UPPER} [{#TASK}] for more than 36h</name>
                                    <opdata>Last backup age: {ITEM.LASTVALUE1}</opdata>
                                    <priority>WARNING</priority>
                                    <dependencies>
                                        <dependency>
                                            <name>No ShadowProtectSPX Backup of {#MACHINE_UPPER} [{#TASK}] for more than 72h</name>
                                            <expression>{Template Futur-Tech App StorageCraft:shadowprotectspx.backup.age[{#MACHINE},{#TASK}].last()}&gt;259200</expression>
                                        </dependency>
                                    </dependencies>
                                </trigger_prototype>
                                <trigger_prototype>
                                    <expression>{last()}&gt;259200</expression>
                                    <name>No ShadowProtectSPX Backup of {#MACHINE_UPPER} [{#TASK}] for more than 72h</name>
                                    <opdata>Last backup age: {ITEM.LASTVALUE1}</opdata>
                                    <priority>HIGH</priority>
                                </trigger_prototype>
                            </trigger_prototypes>
                        </item_prototype>
                        <item_prototype>
                            <name>{#MACHINE_UPPER} Backup [{#TASK}] Success</name>
                            <type>ZABBIX_ACTIVE</type>
                            <key>wmi.get[root\cimv2,SELECT TimeGenerated FROM Win32_NTLogEvent WHERE (logfile='Application') AND (SourceName='ShadowProtectSPX') AND (EventCode=3) AND (Message LIKE '%Backup &quot;{#TASK}&quot; on {#MACHINE} successfully finished backing up%')]</key>
                            <delay>15m</delay>
                            <units>unixtime</units>
                            <applications>
                                <application>
                                    <name>StorageCraft ShadowProtectSPX</name>
                                </application>
                            </applications>
                            <preprocessing>
                                <step>
                                    <type>JAVASCRIPT</type>
                                    <params>var match = /^(\d+)\.\d+-\d+$/gi.exec(value);
var ts = new Date();

ts.setUTCFullYear(match[1].substring(0,4));
ts.setUTCMonth(match[1].substring(4,6)-1);
ts.setUTCDate(match[1].substring(6,8));
ts.setUTCHours(match[1].substring(8,10));
ts.setUTCMinutes(match[1].substring(10,12));
ts.setUTCSeconds(match[1].substring(12,14));
ts.setUTCMilliseconds(0);

return ts.valueOf() / 1000;</params>
                                </step>
                                <step>
                                    <type>DISCARD_UNCHANGED_HEARTBEAT</type>
                                    <params>1d</params>
                                </step>
                            </preprocessing>
                        </item_prototype>
                    </item_prototypes>
                    <trigger_prototypes>
                        <trigger_prototype>
                            <expression>{Template Futur-Tech App StorageCraft:eventlog[Application,,,ShadowProtectSPX,,,skip].regexp(Backup \&quot;{#TASK}\&quot; on {#MACHINE},#1)}=1&#13;
and {Template Futur-Tech App StorageCraft:shadowprotectspx.backup.age[{#MACHINE},{#TASK}].last()}&gt;0&#13;
and {Template Futur-Tech App StorageCraft:eventlog[Application,,,ShadowProtectSPX,,,skip].logseverity()}=9</expression>
                            <recovery_mode>RECOVERY_EXPRESSION</recovery_mode>
                            <recovery_expression>{Template Futur-Tech App StorageCraft:eventlog[Application,,,ShadowProtectSPX,,,skip].regexp(Backup \&quot;{#TASK}\&quot; on {#MACHINE} successfully finished backing up,#1)}=1 &#13;
and {Template Futur-Tech App StorageCraft:eventlog[Application,,,ShadowProtectSPX,,,skip].logseverity()}=1 &#13;
and {Template Futur-Tech App StorageCraft:eventlog[Application,,,ShadowProtectSPX,,,skip].logeventid(3)}=1</recovery_expression>
                            <name>Critical Error in ShadowProtectSPX Event Log for {#MACHINE_UPPER} [{#TASK}]</name>
                            <opdata>Last backup age: {ITEM.LASTVALUE2}</opdata>
                            <priority>HIGH</priority>
                        </trigger_prototype>
                        <trigger_prototype>
                            <expression>{Template Futur-Tech App StorageCraft:eventlog[Application,,,ShadowProtectSPX,,,skip].regexp(Backup \&quot;{#TASK}\&quot; on {#MACHINE},#1)}=1&#13;
and {Template Futur-Tech App StorageCraft:shadowprotectspx.backup.age[{#MACHINE},{#TASK}].last()}&gt;0&#13;
and {Template Futur-Tech App StorageCraft:eventlog[Application,,,ShadowProtectSPX,,,skip].logseverity()}=4</expression>
                            <recovery_mode>RECOVERY_EXPRESSION</recovery_mode>
                            <recovery_expression>{Template Futur-Tech App StorageCraft:eventlog[Application,,,ShadowProtectSPX,,,skip].regexp(Backup \&quot;{#TASK}\&quot; on {#MACHINE} successfully finished backing up,#1)}=1 &#13;
and {Template Futur-Tech App StorageCraft:eventlog[Application,,,ShadowProtectSPX,,,skip].logseverity()}=1 &#13;
and {Template Futur-Tech App StorageCraft:eventlog[Application,,,ShadowProtectSPX,,,skip].logeventid(3)}=1</recovery_expression>
                            <name>Error in ShadowProtectSPX Event Log for {#MACHINE_UPPER} [{#TASK}]</name>
                            <opdata>Last backup age: {ITEM.LASTVALUE2}</opdata>
                            <priority>AVERAGE</priority>
                            <dependencies>
                                <dependency>
                                    <name>Critical Error in ShadowProtectSPX Event Log for {#MACHINE_UPPER} [{#TASK}]</name>
                                    <expression>{Template Futur-Tech App StorageCraft:eventlog[Application,,,ShadowProtectSPX,,,skip].regexp(Backup \&quot;{#TASK}\&quot; on {#MACHINE},#1)}=1&#13;
and {Template Futur-Tech App StorageCraft:shadowprotectspx.backup.age[{#MACHINE},{#TASK}].last()}&gt;0&#13;
and {Template Futur-Tech App StorageCraft:eventlog[Application,,,ShadowProtectSPX,,,skip].logseverity()}=9</expression>
                                    <recovery_expression>{Template Futur-Tech App StorageCraft:eventlog[Application,,,ShadowProtectSPX,,,skip].regexp(Backup \&quot;{#TASK}\&quot; on {#MACHINE} successfully finished backing up,#1)}=1 &#13;
and {Template Futur-Tech App StorageCraft:eventlog[Application,,,ShadowProtectSPX,,,skip].logseverity()}=1 &#13;
and {Template Futur-Tech App StorageCraft:eventlog[Application,,,ShadowProtectSPX,,,skip].logeventid(3)}=1</recovery_expression>
                                </dependency>
                            </dependencies>
                        </trigger_prototype>
                        <trigger_prototype>
                            <expression>{Template Futur-Tech App StorageCraft:eventlog[Application,,,ShadowProtectSPX,,,skip].regexp(Backup \&quot;{#TASK}\&quot; on {#MACHINE},#1)}=1&#13;
and {Template Futur-Tech App StorageCraft:shadowprotectspx.backup.age[{#MACHINE},{#TASK}].last()}&gt;0&#13;
and {Template Futur-Tech App StorageCraft:eventlog[Application,,,ShadowProtectSPX,,,skip].logseverity()}=2</expression>
                            <recovery_mode>RECOVERY_EXPRESSION</recovery_mode>
                            <recovery_expression>{Template Futur-Tech App StorageCraft:eventlog[Application,,,ShadowProtectSPX,,,skip].regexp(Backup \&quot;{#TASK}\&quot; on {#MACHINE} successfully finished backing up,#1)}=1 &#13;
and {Template Futur-Tech App StorageCraft:eventlog[Application,,,ShadowProtectSPX,,,skip].logseverity()}=1 &#13;
and {Template Futur-Tech App StorageCraft:eventlog[Application,,,ShadowProtectSPX,,,skip].logeventid(3)}=1</recovery_expression>
                            <name>Warning in ShadowProtectSPX Event Log for {#MACHINE_UPPER} [{#TASK}]</name>
                            <opdata>Last backup age: {ITEM.LASTVALUE2}</opdata>
                            <priority>WARNING</priority>
                            <dependencies>
                                <dependency>
                                    <name>Critical Error in ShadowProtectSPX Event Log for {#MACHINE_UPPER} [{#TASK}]</name>
                                    <expression>{Template Futur-Tech App StorageCraft:eventlog[Application,,,ShadowProtectSPX,,,skip].regexp(Backup \&quot;{#TASK}\&quot; on {#MACHINE},#1)}=1&#13;
and {Template Futur-Tech App StorageCraft:shadowprotectspx.backup.age[{#MACHINE},{#TASK}].last()}&gt;0&#13;
and {Template Futur-Tech App StorageCraft:eventlog[Application,,,ShadowProtectSPX,,,skip].logseverity()}=9</expression>
                                    <recovery_expression>{Template Futur-Tech App StorageCraft:eventlog[Application,,,ShadowProtectSPX,,,skip].regexp(Backup \&quot;{#TASK}\&quot; on {#MACHINE} successfully finished backing up,#1)}=1 &#13;
and {Template Futur-Tech App StorageCraft:eventlog[Application,,,ShadowProtectSPX,,,skip].logseverity()}=1 &#13;
and {Template Futur-Tech App StorageCraft:eventlog[Application,,,ShadowProtectSPX,,,skip].logeventid(3)}=1</recovery_expression>
                                </dependency>
                                <dependency>
                                    <name>Error in ShadowProtectSPX Event Log for {#MACHINE_UPPER} [{#TASK}]</name>
                                    <expression>{Template Futur-Tech App StorageCraft:eventlog[Application,,,ShadowProtectSPX,,,skip].regexp(Backup \&quot;{#TASK}\&quot; on {#MACHINE},#1)}=1&#13;
and {Template Futur-Tech App StorageCraft:shadowprotectspx.backup.age[{#MACHINE},{#TASK}].last()}&gt;0&#13;
and {Template Futur-Tech App StorageCraft:eventlog[Application,,,ShadowProtectSPX,,,skip].logseverity()}=4</expression>
                                    <recovery_expression>{Template Futur-Tech App StorageCraft:eventlog[Application,,,ShadowProtectSPX,,,skip].regexp(Backup \&quot;{#TASK}\&quot; on {#MACHINE} successfully finished backing up,#1)}=1 &#13;
and {Template Futur-Tech App StorageCraft:eventlog[Application,,,ShadowProtectSPX,,,skip].logseverity()}=1 &#13;
and {Template Futur-Tech App StorageCraft:eventlog[Application,,,ShadowProtectSPX,,,skip].logeventid(3)}=1</recovery_expression>
                                </dependency>
                            </dependencies>
                        </trigger_prototype>
                    </trigger_prototypes>
                    <master_item>
                        <key>eventlog[Application,,,ShadowProtectSPX,,,skip]</key>
                    </master_item>
                    <preprocessing>
                        <step>
                            <type>REGEX</type>
                            <params>Backup &quot;([^&quot;]+)&quot; on (.+) successfully finished backing up
\0</params>
                        </step>
                        <step>
                            <type>JAVASCRIPT</type>
                            <params>var lld = [];
var row = {};
var matches = /Backup &quot;([^&quot;]+)&quot; on (.+) successfully finished backing up/gi.exec(value);
row[&quot;{#TASK}&quot;] = matches[1];
row[&quot;{#MACHINE}&quot;] = matches[2];
row[&quot;{#MACHINE_UPPER}&quot;] = row[&quot;{#MACHINE}&quot;].toUpperCase();
lld.push(row);
return JSON.stringify(lld);</params>
                        </step>
                    </preprocessing>
                </discovery_rule>
            </discovery_rules>
        </template>
    </templates>
</zabbix_export>
