<?xml version="1.0" encoding="UTF-8"?>
<zabbix_export>
    <version>5.0</version>
    <date>2021-12-12T13:40:23Z</date>
    <groups>
        <group>
            <name>Templates/Futur-Tech/Applications</name>
        </group>
    </groups>
    <templates>
        <template>
            <template>Template Futur-Tech App StorageCraft</template>
            <name>Template Futur-Tech App StorageCraft</name>
            <description>https://github.com/Futur-Tech/futur-tech-zabbix-storagecraft</description>
            <groups>
                <group>
                    <name>Templates/Futur-Tech/Applications</name>
                </group>
            </groups>
            <applications>
                <application>
                    <name>StorageCraft Dashboard</name>
                </application>
                <application>
                    <name>StorageCraft ImageManager</name>
                </application>
                <application>
                    <name>StorageCraft ShadowProtectSPX</name>
                </application>
            </applications>
            <items>
                <item>
                    <name>ShadowProtectSPX Event Log</name>
                    <type>ZABBIX_ACTIVE</type>
                    <key>eventlog[Application,,,ShadowProtectSPX,,,skip]</key>
                    <delay>5m</delay>
                    <trends>0</trends>
                    <value_type>LOG</value_type>
                    <applications>
                        <application>
                            <name>StorageCraft ShadowProtectSPX</name>
                        </application>
                    </applications>
                    <triggers>
                        <trigger>
                            <expression>{regexp(Backup \&quot;[^\&quot;]+\&quot; on,#1)}=0 and {logseverity()}=9</expression>
                            <recovery_mode>NONE</recovery_mode>
                            <name>Critical Error in ShadowProtectSPX Event Log</name>
                            <opdata>{{ITEM.VALUE}.regsub(&quot;([\s\S]*)&quot;, \1)}</opdata>
                            <priority>HIGH</priority>
                            <description>This trigger need to be manually closed.</description>
                            <type>MULTIPLE</type>
                            <manual_close>YES</manual_close>
                        </trigger>
                        <trigger>
                            <expression>{regexp(Backup \&quot;[^\&quot;]+\&quot; on,#1)}=0 and {logseverity()}=4</expression>
                            <recovery_mode>NONE</recovery_mode>
                            <name>Error in ShadowProtectSPX Event Log</name>
                            <opdata>{{ITEM.VALUE}.regsub(&quot;([\s\S]*)&quot;, \1)}</opdata>
                            <priority>AVERAGE</priority>
                            <description>This trigger need to be manually closed.</description>
                            <type>MULTIPLE</type>
                            <manual_close>YES</manual_close>
                        </trigger>
                        <trigger>
                            <expression>{regexp(Backup \&quot;[^\&quot;]+\&quot; on,#1)}=0 and {logseverity()}=1</expression>
                            <recovery_mode>NONE</recovery_mode>
                            <name>Information in ShadowProtectSPX Event Log</name>
                            <opdata>{{ITEM.VALUE}.regsub(&quot;([\s\S]*)&quot;, \1)}</opdata>
                            <status>DISABLED</status>
                            <priority>INFO</priority>
                            <description>This trigger need to be manually closed.</description>
                            <type>MULTIPLE</type>
                            <manual_close>YES</manual_close>
                        </trigger>
                        <trigger>
                            <expression>{regexp(Backup \&quot;[^\&quot;]+\&quot; on,#1)}=0 and {logseverity()}=2</expression>
                            <recovery_mode>NONE</recovery_mode>
                            <name>Warning in ShadowProtectSPX Event Log</name>
                            <opdata>{{ITEM.VALUE}.regsub(&quot;([\s\S]*)&quot;, \1)}</opdata>
                            <priority>WARNING</priority>
                            <description>This trigger need to be manually closed.</description>
                            <type>MULTIPLE</type>
                            <manual_close>YES</manual_close>
                        </trigger>
                    </triggers>
                </item>
                <item>
                    <name>ImageManager Event Log</name>
                    <type>ZABBIX_ACTIVE</type>
                    <key>eventlog[Application,,,StorageCraft ImageManager,,,skip]</key>
                    <delay>5m</delay>
                    <trends>0</trends>
                    <value_type>LOG</value_type>
                    <applications>
                        <application>
                            <name>StorageCraft ImageManager</name>
                        </application>
                    </applications>
                    <triggers>
                        <trigger>
                            <expression>{regexp(\\.+\\.+\\,#1)}=0 and {logseverity()}=9</expression>
                            <recovery_mode>NONE</recovery_mode>
                            <name>Critical Error in ImageManager Event Log</name>
                            <opdata>{{ITEM.VALUE}.regsub(&quot;([\s\S]*)&quot;, \1)}</opdata>
                            <priority>HIGH</priority>
                            <description>This trigger need to be manually closed.</description>
                            <type>MULTIPLE</type>
                            <manual_close>YES</manual_close>
                        </trigger>
                        <trigger>
                            <expression>{regexp(\\.+\\.+\\,#1)}=0 and {logseverity()}=4</expression>
                            <recovery_mode>NONE</recovery_mode>
                            <name>Error in ImageManager Event Log</name>
                            <opdata>{{ITEM.VALUE}.regsub(&quot;([\s\S]*)&quot;, \1)}</opdata>
                            <priority>AVERAGE</priority>
                            <description>This trigger need to be manually closed.</description>
                            <type>MULTIPLE</type>
                            <manual_close>YES</manual_close>
                        </trigger>
                        <trigger>
                            <expression>{regexp(\\.+\\.+\\,#1)}=0 and {logseverity()}=1</expression>
                            <recovery_mode>NONE</recovery_mode>
                            <name>Information in ImageManager Event Log</name>
                            <opdata>{{ITEM.VALUE}.regsub(&quot;([\s\S]*)&quot;, \1)}</opdata>
                            <status>DISABLED</status>
                            <priority>INFO</priority>
                            <description>This trigger need to be manually closed.</description>
                            <type>MULTIPLE</type>
                            <manual_close>YES</manual_close>
                        </trigger>
                        <trigger>
                            <expression>{regexp(\\.+\\.+\\,#1)}=0 and {logseverity()}=2</expression>
                            <recovery_mode>NONE</recovery_mode>
                            <name>Warning in ImageManager Event Log</name>
                            <opdata>{{ITEM.VALUE}.regsub(&quot;([\s\S]*)&quot;, \1)}</opdata>
                            <priority>WARNING</priority>
                            <description>This trigger need to be manually closed.</description>
                            <type>MULTIPLE</type>
                            <manual_close>YES</manual_close>
                        </trigger>
                    </triggers>
                </item>
            </items>
            <discovery_rules>
                <discovery_rule>
                    <name>ImageManager Discovery</name>
                    <type>DEPENDENT</type>
                    <key>storagecraft.imagemanager.discovery</key>
                    <delay>0</delay>
                    <item_prototypes>
                        <item_prototype>
                            <name>{#MACHINE_UPPER} Collapse [{#VOL}] Age</name>
                            <type>CALCULATED</type>
                            <key>imagemanager.collapse.age[{#MACHINE},{#VOL}]</key>
                            <delay>5m</delay>
                            <units>uptime</units>
                            <params>now(&quot;wmi.get[root\cimv2,SELECT TimeGenerated FROM Win32_NTLogEvent WHERE (logfile='Application') AND (SourceName='StorageCraft ImageManager') AND (EventCode=1120) AND (Message LIKE '{#PATH_ESC}\\{#VOL}%.spi')]&quot;)-last(&quot;wmi.get[root\cimv2,SELECT TimeGenerated FROM Win32_NTLogEvent WHERE (logfile='Application') AND (SourceName='StorageCraft ImageManager') AND (EventCode=1120) AND (Message LIKE '{#PATH_ESC}\\{#VOL}%.spi')]&quot;)</params>
                            <applications>
                                <application>
                                    <name>StorageCraft Dashboard</name>
                                </application>
                                <application>
                                    <name>StorageCraft ImageManager</name>
                                </application>
                            </applications>
                            <trigger_prototypes>
                                <trigger_prototype>
                                    <expression>{last()}&gt;{$STORAGECRAFT.COLLAPSE.CRIT:&quot;{#MACHINE}&quot;}&#13;
and {$STORAGECRAFT.COLLAPSE.IGNORE:&quot;{#MACHINE} [{#VOL}]&quot;}=0 &#13;
and {$STORAGECRAFT.COLLAPSE.IGNORE:&quot;{#MACHINE}&quot;}=0</expression>
                                    <name>No ImageManager Collapse of {#MACHINE_UPPER} [{#VOL}] for more than {$STORAGECRAFT.COLLAPSE.CRIT:&quot;{#MACHINE}&quot;}</name>
                                    <opdata>Last collapse age: {ITEM.LASTVALUE1}</opdata>
                                    <priority>HIGH</priority>
                                </trigger_prototype>
                                <trigger_prototype>
                                    <expression>{last()}&gt;{$STORAGECRAFT.COLLAPSE.WARN:&quot;{#MACHINE}&quot;}&#13;
and {$STORAGECRAFT.COLLAPSE.IGNORE:&quot;{#MACHINE} [{#VOL}]&quot;}=0 &#13;
and {$STORAGECRAFT.COLLAPSE.IGNORE:&quot;{#MACHINE}&quot;}=0</expression>
                                    <name>No ImageManager Collapse of {#MACHINE_UPPER} [{#VOL}] for more than {$STORAGECRAFT.COLLAPSE.WARN:&quot;{#MACHINE}&quot;}</name>
                                    <opdata>Last collapse age: {ITEM.LASTVALUE1}</opdata>
                                    <priority>WARNING</priority>
                                    <dependencies>
                                        <dependency>
                                            <name>No ImageManager Collapse of {#MACHINE_UPPER} [{#VOL}] for more than {$STORAGECRAFT.COLLAPSE.CRIT:&quot;{#MACHINE}&quot;}</name>
                                            <expression>{Template Futur-Tech App StorageCraft:imagemanager.collapse.age[{#MACHINE},{#VOL}].last()}&gt;{$STORAGECRAFT.COLLAPSE.CRIT:&quot;{#MACHINE}&quot;}&#13;
and {$STORAGECRAFT.COLLAPSE.IGNORE:&quot;{#MACHINE} [{#VOL}]&quot;}=0 &#13;
and {$STORAGECRAFT.COLLAPSE.IGNORE:&quot;{#MACHINE}&quot;}=0</expression>
                                        </dependency>
                                    </dependencies>
                                </trigger_prototype>
                            </trigger_prototypes>
                        </item_prototype>
                        <item_prototype>
                            <name>{#MACHINE_UPPER} Chkdsk [{#VOL}] Log</name>
                            <type>ZABBIX_ACTIVE</type>
                            <key>logrt[&quot;C:\Program Files (x86)\StorageCraft\ImageManager\Logs\^\[{#PATH_LOGNAME}\]-\d+\.log$&quot;,&quot;Chkdsk.+ {#VOL}[-\w]+\.spi&quot;,,,skip]</key>
                            <delay>15m</delay>
                            <trends>0</trends>
                            <value_type>LOG</value_type>
                            <applications>
                                <application>
                                    <name>StorageCraft ImageManager</name>
                                </application>
                            </applications>
                        </item_prototype>
                        <item_prototype>
                            <name>{#MACHINE_UPPER} VirtualBoot [{#VOL}] Log</name>
                            <type>ZABBIX_ACTIVE</type>
                            <key>logrt[&quot;C:\Program Files (x86)\StorageCraft\ImageManager\Logs\^\[{#PATH_LOGNAME}\]-\d+\.log$&quot;,&quot;{#VOL}[-\w]+_VirtualBoot_VM| screenshot| VM|_VM_|vboxmanage|[Vv]irtual[ ]*[Bb]o|Hyper-V|^Generated (disks|incremental images)&quot;,,,skip]</key>
                            <delay>15m</delay>
                            <trends>0</trends>
                            <value_type>LOG</value_type>
                            <description>Note that some lines might be missing from this log. Use the original log file located in C:\Program Files (x86)\StorageCraft\ImageManager\Logs\ for debugging.</description>
                            <applications>
                                <application>
                                    <name>StorageCraft ImageManager</name>
                                </application>
                            </applications>
                        </item_prototype>
                        <item_prototype>
                            <name>{#MACHINE_UPPER} Collapse [{#VOL}] Success</name>
                            <type>ZABBIX_ACTIVE</type>
                            <key>wmi.get[root\cimv2,SELECT TimeGenerated FROM Win32_NTLogEvent WHERE (logfile='Application') AND (SourceName='StorageCraft ImageManager') AND (EventCode=1120) AND (Message LIKE '{#PATH_ESC}\\{#VOL}%.spi')]</key>
                            <delay>15m</delay>
                            <units>unixtime</units>
                            <applications>
                                <application>
                                    <name>StorageCraft ImageManager</name>
                                </application>
                            </applications>
                            <preprocessing>
                                <step>
                                    <type>JAVASCRIPT</type>
                                    <params>var match = /^(\d+)\.\d+-\d+$/gi.exec(value);
var ts = new Date();

ts.setUTCFullYear(match[1].substring(0,4));
ts.setUTCMonth(match[1].substring(4,6)-1);
ts.setUTCDate(match[1].substring(6,8));
ts.setUTCHours(match[1].substring(8,10));
ts.setUTCMinutes(match[1].substring(10,12));
ts.setUTCSeconds(match[1].substring(12,14));
ts.setUTCMilliseconds(0);

return ts.valueOf() / 1000;</params>
                                </step>
                                <step>
                                    <type>DISCARD_UNCHANGED_HEARTBEAT</type>
                                    <params>1d</params>
                                </step>
                            </preprocessing>
                        </item_prototype>
                    </item_prototypes>
                    <trigger_prototypes>
                        <trigger_prototype>
                            <expression>{Template Futur-Tech App StorageCraft:logrt[&quot;C:\Program Files (x86)\StorageCraft\ImageManager\Logs\^\[{#PATH_LOGNAME}\]-\d+\.log$&quot;,&quot;Chkdsk.+ {#VOL}[-\w]+\.spi&quot;,,,skip].regexp(&quot;Chkdsk verify failed: {#VOL}[-\w]+\.spi&quot;,#1)}=1&#13;
and {Template Futur-Tech App StorageCraft:imagemanager.collapse.age[{#MACHINE},{#VOL}].now()}&gt;0&#13;
and {$STORAGECRAFT.COLLAPSE.IGNORE:&quot;{#MACHINE} [{#VOL}]&quot;}=0 &#13;
and {$STORAGECRAFT.COLLAPSE.IGNORE:&quot;{#MACHINE}&quot;}=0</expression>
                            <recovery_mode>RECOVERY_EXPRESSION</recovery_mode>
                            <recovery_expression>{Template Futur-Tech App StorageCraft:logrt[&quot;C:\Program Files (x86)\StorageCraft\ImageManager\Logs\^\[{#PATH_LOGNAME}\]-\d+\.log$&quot;,&quot;Chkdsk.+ {#VOL}[-\w]+\.spi&quot;,,,skip].regexp(&quot;Chkdsk verify succeeded: {#VOL}[-\w]+\.spi \(No errors were found\)&quot;,#1)}=1&#13;
or ({$STORAGECRAFT.COLLAPSE.IGNORE:&quot;{#MACHINE} [{#VOL}]&quot;}=1&#13;
    or {$STORAGECRAFT.COLLAPSE.IGNORE:&quot;{#MACHINE}&quot;}=1)</recovery_expression>
                            <name>CHKDSK Error for {#MACHINE_UPPER} [{#VOL}] Collapse</name>
                            <opdata>Log: {{ITEM.VALUE}.regsub(&quot;(.*)&quot;, \1)}</opdata>
                            <priority>AVERAGE</priority>
                        </trigger_prototype>
                        <trigger_prototype>
                            <expression>{Template Futur-Tech App StorageCraft:eventlog[Application,,,StorageCraft ImageManager,,,skip].regexp({#PATH_ESC},#1)}=1&#13;
and &#13;
    ({Template Futur-Tech App StorageCraft:eventlog[Application,,,StorageCraft ImageManager,,,skip].regexp([\W]{#VOL}-.+\.spi,#1)}=1 &#13;
    or&#13;
    {Template Futur-Tech App StorageCraft:eventlog[Application,,,StorageCraft ImageManager,,,skip].regexp(_VOL-b\d+-.+\.spi,#1)}=0) &#13;
and {Template Futur-Tech App StorageCraft:imagemanager.collapse.age[{#MACHINE},{#VOL}].last()}&gt;0&#13;
and {Template Futur-Tech App StorageCraft:eventlog[Application,,,StorageCraft ImageManager,,,skip].logseverity()}=9&#13;
and {$STORAGECRAFT.COLLAPSE.IGNORE:&quot;{#MACHINE} [{#VOL}]&quot;}=0 &#13;
and {$STORAGECRAFT.COLLAPSE.IGNORE:&quot;{#MACHINE}&quot;}=0</expression>
                            <recovery_mode>RECOVERY_EXPRESSION</recovery_mode>
                            <recovery_expression>{Template Futur-Tech App StorageCraft:eventlog[Application,,,StorageCraft ImageManager,,,skip].regexp({#PATH_ESC}\\{#VOL}-.+\.spi,#1)}=1&#13;
and {Template Futur-Tech App StorageCraft:eventlog[Application,,,StorageCraft ImageManager,,,skip].logseverity()}=1&#13;
and {Template Futur-Tech App StorageCraft:eventlog[Application,,,StorageCraft ImageManager,,,skip].logeventid(1120)}=1&#13;
or ({$STORAGECRAFT.COLLAPSE.IGNORE:&quot;{#MACHINE} [{#VOL}]&quot;}=1&#13;
    or {$STORAGECRAFT.COLLAPSE.IGNORE:&quot;{#MACHINE}&quot;}=1)</recovery_expression>
                            <name>Critical Error in ImageManager Event Log for {#MACHINE_UPPER} [{#VOL}]</name>
                            <opdata>Last collapse age: {ITEM.LASTVALUE4}, ImageManager Log: {ITEM.VALUE1}</opdata>
                            <priority>HIGH</priority>
                            <manual_close>YES</manual_close>
                        </trigger_prototype>
                        <trigger_prototype>
                            <expression>{Template Futur-Tech App StorageCraft:eventlog[Application,,,StorageCraft ImageManager,,,skip].regexp({#PATH_ESC},#1)}=1&#13;
and &#13;
    ({Template Futur-Tech App StorageCraft:eventlog[Application,,,StorageCraft ImageManager,,,skip].regexp([\W]{#VOL}-.+\.spi,#1)}=1 &#13;
    or&#13;
    {Template Futur-Tech App StorageCraft:eventlog[Application,,,StorageCraft ImageManager,,,skip].regexp(_VOL-b\d+-.+\.spi,#1)}=0) &#13;
and {Template Futur-Tech App StorageCraft:imagemanager.collapse.age[{#MACHINE},{#VOL}].last()}&gt;0&#13;
and {Template Futur-Tech App StorageCraft:eventlog[Application,,,StorageCraft ImageManager,,,skip].logseverity()}=4&#13;
and {$STORAGECRAFT.COLLAPSE.IGNORE:&quot;{#MACHINE} [{#VOL}]&quot;}=0 &#13;
and {$STORAGECRAFT.COLLAPSE.IGNORE:&quot;{#MACHINE}&quot;}=0</expression>
                            <recovery_mode>RECOVERY_EXPRESSION</recovery_mode>
                            <recovery_expression>{Template Futur-Tech App StorageCraft:eventlog[Application,,,StorageCraft ImageManager,,,skip].regexp({#PATH_ESC}\\{#VOL}-.+\.spi,#1)}=1&#13;
and {Template Futur-Tech App StorageCraft:eventlog[Application,,,StorageCraft ImageManager,,,skip].logseverity()}=1&#13;
and {Template Futur-Tech App StorageCraft:eventlog[Application,,,StorageCraft ImageManager,,,skip].logeventid(1120)}=1&#13;
or ({$STORAGECRAFT.COLLAPSE.IGNORE:&quot;{#MACHINE} [{#VOL}]&quot;}=1&#13;
    or {$STORAGECRAFT.COLLAPSE.IGNORE:&quot;{#MACHINE}&quot;}=1)</recovery_expression>
                            <name>Error in ImageManager Event Log for {#MACHINE_UPPER} [{#VOL}]</name>
                            <opdata>Last collapse age: {ITEM.LASTVALUE4}, ImageManager Log: {ITEM.VALUE1}</opdata>
                            <priority>AVERAGE</priority>
                            <manual_close>YES</manual_close>
                            <dependencies>
                                <dependency>
                                    <name>Critical Error in ImageManager Event Log for {#MACHINE_UPPER} [{#VOL}]</name>
                                    <expression>{Template Futur-Tech App StorageCraft:eventlog[Application,,,StorageCraft ImageManager,,,skip].regexp({#PATH_ESC},#1)}=1&#13;
and &#13;
    ({Template Futur-Tech App StorageCraft:eventlog[Application,,,StorageCraft ImageManager,,,skip].regexp([\W]{#VOL}-.+\.spi,#1)}=1 &#13;
    or&#13;
    {Template Futur-Tech App StorageCraft:eventlog[Application,,,StorageCraft ImageManager,,,skip].regexp(_VOL-b\d+-.+\.spi,#1)}=0) &#13;
and {Template Futur-Tech App StorageCraft:imagemanager.collapse.age[{#MACHINE},{#VOL}].last()}&gt;0&#13;
and {Template Futur-Tech App StorageCraft:eventlog[Application,,,StorageCraft ImageManager,,,skip].logseverity()}=9&#13;
and {$STORAGECRAFT.COLLAPSE.IGNORE:&quot;{#MACHINE} [{#VOL}]&quot;}=0 &#13;
and {$STORAGECRAFT.COLLAPSE.IGNORE:&quot;{#MACHINE}&quot;}=0</expression>
                                    <recovery_expression>{Template Futur-Tech App StorageCraft:eventlog[Application,,,StorageCraft ImageManager,,,skip].regexp({#PATH_ESC}\\{#VOL}-.+\.spi,#1)}=1&#13;
and {Template Futur-Tech App StorageCraft:eventlog[Application,,,StorageCraft ImageManager,,,skip].logseverity()}=1&#13;
and {Template Futur-Tech App StorageCraft:eventlog[Application,,,StorageCraft ImageManager,,,skip].logeventid(1120)}=1&#13;
or ({$STORAGECRAFT.COLLAPSE.IGNORE:&quot;{#MACHINE} [{#VOL}]&quot;}=1&#13;
    or {$STORAGECRAFT.COLLAPSE.IGNORE:&quot;{#MACHINE}&quot;}=1)</recovery_expression>
                                </dependency>
                            </dependencies>
                        </trigger_prototype>
                        <trigger_prototype>
                            <expression>{Template Futur-Tech App StorageCraft:logrt[&quot;C:\Program Files (x86)\StorageCraft\ImageManager\Logs\^\[{#PATH_LOGNAME}\]-\d+\.log$&quot;,&quot;Chkdsk.+ {#VOL}[-\w]+\.spi&quot;,,,skip].regexp(&quot;Chkdsk verify succeeded: {#VOL}[-\w]+\.spi \(No errors were found\)&quot;,{$STORAGECRAFT.COLLAPSE.CHKDSK.CRIT})}=0&#13;
and {Template Futur-Tech App StorageCraft:imagemanager.collapse.age[{#MACHINE},{#VOL}].now()}&gt;0&#13;
and {$STORAGECRAFT.COLLAPSE.CHKDSK:&quot;{#MACHINE_UPPER}&quot;}=1&#13;
and {$STORAGECRAFT.COLLAPSE.IGNORE:&quot;{#MACHINE} [{#VOL}]&quot;}=0 &#13;
and {$STORAGECRAFT.COLLAPSE.IGNORE:&quot;{#MACHINE}&quot;}=0</expression>
                            <name>No CHKDSK for {#MACHINE_UPPER} [{#VOL}] Collapse in last {$STORAGECRAFT.COLLAPSE.CHKDSK.CRIT}</name>
                            <opdata>Log: {{ITEM.VALUE}.regsub(&quot;(.*)&quot;, \1)}</opdata>
                            <priority>AVERAGE</priority>
                            <dependencies>
                                <dependency>
                                    <name>CHKDSK Error for {#MACHINE_UPPER} [{#VOL}] Collapse</name>
                                    <expression>{Template Futur-Tech App StorageCraft:logrt[&quot;C:\Program Files (x86)\StorageCraft\ImageManager\Logs\^\[{#PATH_LOGNAME}\]-\d+\.log$&quot;,&quot;Chkdsk.+ {#VOL}[-\w]+\.spi&quot;,,,skip].regexp(&quot;Chkdsk verify failed: {#VOL}[-\w]+\.spi&quot;,#1)}=1&#13;
and {Template Futur-Tech App StorageCraft:imagemanager.collapse.age[{#MACHINE},{#VOL}].now()}&gt;0&#13;
and {$STORAGECRAFT.COLLAPSE.IGNORE:&quot;{#MACHINE} [{#VOL}]&quot;}=0 &#13;
and {$STORAGECRAFT.COLLAPSE.IGNORE:&quot;{#MACHINE}&quot;}=0</expression>
                                    <recovery_expression>{Template Futur-Tech App StorageCraft:logrt[&quot;C:\Program Files (x86)\StorageCraft\ImageManager\Logs\^\[{#PATH_LOGNAME}\]-\d+\.log$&quot;,&quot;Chkdsk.+ {#VOL}[-\w]+\.spi&quot;,,,skip].regexp(&quot;Chkdsk verify succeeded: {#VOL}[-\w]+\.spi \(No errors were found\)&quot;,#1)}=1&#13;
or ({$STORAGECRAFT.COLLAPSE.IGNORE:&quot;{#MACHINE} [{#VOL}]&quot;}=1&#13;
    or {$STORAGECRAFT.COLLAPSE.IGNORE:&quot;{#MACHINE}&quot;}=1)</recovery_expression>
                                </dependency>
                            </dependencies>
                        </trigger_prototype>
                        <trigger_prototype>
                            <expression>{Template Futur-Tech App StorageCraft:logrt[&quot;C:\Program Files (x86)\StorageCraft\ImageManager\Logs\^\[{#PATH_LOGNAME}\]-\d+\.log$&quot;,&quot;{#VOL}[-\w]+_VirtualBoot_VM| screenshot| VM|_VM_|vboxmanage|[Vv]irtual[ ]*[Bb]o|Hyper-V|^Generated (disks|incremental images)&quot;,,,skip].regexp(^Took screenshot ,{$STORAGECRAFT.COLLAPSE.VIRTUALBOOT.CRIT})}=0 &#13;
and {Template Futur-Tech App StorageCraft:imagemanager.collapse.age[{#MACHINE},{#VOL}].now()}&gt;0&#13;
and {$STORAGECRAFT.COLLAPSE.VIRTUALBOOT:&quot;{#MACHINE_UPPER}&quot;}=1&#13;
and {$STORAGECRAFT.COLLAPSE.IGNORE:&quot;{#MACHINE} [{#VOL}]&quot;}=0 &#13;
and {$STORAGECRAFT.COLLAPSE.IGNORE:&quot;{#MACHINE}&quot;}=0</expression>
                            <name>No VirtualBoot for {#MACHINE_UPPER} [{#VOL}] Collapse in last {$STORAGECRAFT.COLLAPSE.VIRTUALBOOT.CRIT}</name>
                            <opdata>Log: {{ITEM.LASTVALUE1}.regsub(&quot;(.*)&quot;, \1)}</opdata>
                            <priority>AVERAGE</priority>
                            <dependencies>
                                <dependency>
                                    <name>No CHKDSK for {#MACHINE_UPPER} [{#VOL}] Collapse in last {$STORAGECRAFT.COLLAPSE.CHKDSK.CRIT}</name>
                                    <expression>{Template Futur-Tech App StorageCraft:logrt[&quot;C:\Program Files (x86)\StorageCraft\ImageManager\Logs\^\[{#PATH_LOGNAME}\]-\d+\.log$&quot;,&quot;Chkdsk.+ {#VOL}[-\w]+\.spi&quot;,,,skip].regexp(&quot;Chkdsk verify succeeded: {#VOL}[-\w]+\.spi \(No errors were found\)&quot;,{$STORAGECRAFT.COLLAPSE.CHKDSK.CRIT})}=0&#13;
and {Template Futur-Tech App StorageCraft:imagemanager.collapse.age[{#MACHINE},{#VOL}].now()}&gt;0&#13;
and {$STORAGECRAFT.COLLAPSE.CHKDSK:&quot;{#MACHINE_UPPER}&quot;}=1&#13;
and {$STORAGECRAFT.COLLAPSE.IGNORE:&quot;{#MACHINE} [{#VOL}]&quot;}=0 &#13;
and {$STORAGECRAFT.COLLAPSE.IGNORE:&quot;{#MACHINE}&quot;}=0</expression>
                                </dependency>
                                <dependency>
                                    <name>VirtualBoot Error for {#MACHINE_UPPER} [{#VOL}] Collapse</name>
                                    <expression>{Template Futur-Tech App StorageCraft:logrt[&quot;C:\Program Files (x86)\StorageCraft\ImageManager\Logs\^\[{#PATH_LOGNAME}\]-\d+\.log$&quot;,&quot;{#VOL}[-\w]+_VirtualBoot_VM| screenshot| VM|_VM_|vboxmanage|[Vv]irtual[ ]*[Bb]o|Hyper-V|^Generated (disks|incremental images)&quot;,,,skip].regexp(virtual boot exception: {#VOL}[-\w]+\.spi,#1)}=1 and {Template Futur-Tech App StorageCraft:imagemanager.collapse.age[{#MACHINE},{#VOL}].now()}&gt;0&#13;
and {$STORAGECRAFT.COLLAPSE.IGNORE:&quot;{#MACHINE} [{#VOL}]&quot;}=0 &#13;
and {$STORAGECRAFT.COLLAPSE.IGNORE:&quot;{#MACHINE}&quot;}=0</expression>
                                    <recovery_expression>{Template Futur-Tech App StorageCraft:logrt[&quot;C:\Program Files (x86)\StorageCraft\ImageManager\Logs\^\[{#PATH_LOGNAME}\]-\d+\.log$&quot;,&quot;{#VOL}[-\w]+_VirtualBoot_VM| screenshot| VM|_VM_|vboxmanage|[Vv]irtual[ ]*[Bb]o|Hyper-V|^Generated (disks|incremental images)&quot;,,,skip].regexp(^Took screenshot,#1)}=1&#13;
or ({$STORAGECRAFT.COLLAPSE.IGNORE:&quot;{#MACHINE} [{#VOL}]&quot;}=1&#13;
    or {$STORAGECRAFT.COLLAPSE.IGNORE:&quot;{#MACHINE}&quot;}=1)</recovery_expression>
                                </dependency>
                            </dependencies>
                        </trigger_prototype>
                        <trigger_prototype>
                            <expression>{Template Futur-Tech App StorageCraft:logrt[&quot;C:\Program Files (x86)\StorageCraft\ImageManager\Logs\^\[{#PATH_LOGNAME}\]-\d+\.log$&quot;,&quot;Chkdsk.+ {#VOL}[-\w]+\.spi&quot;,,,skip].regexp(&quot;Chkdsk verify succeeded: {#VOL}[-\w]+\.spi \(No errors were found\)&quot;,{$STORAGECRAFT.COLLAPSE.CHKDSK.INFO})}=1 and {Template Futur-Tech App StorageCraft:imagemanager.collapse.age[{#MACHINE},{#VOL}].now()}&gt;0&#13;
and {$STORAGECRAFT.COLLAPSE.IGNORE:&quot;{#MACHINE} [{#VOL}]&quot;}=0 &#13;
and {$STORAGECRAFT.COLLAPSE.IGNORE:&quot;{#MACHINE}&quot;}=0</expression>
                            <name>Succeeded CHKDSK for {#MACHINE_UPPER} [{#VOL}] Collapse in last {$STORAGECRAFT.COLLAPSE.CHKDSK.INFO}</name>
                            <opdata>Log: {ITEM.LASTVALUE1}</opdata>
                            <priority>INFO</priority>
                        </trigger_prototype>
                        <trigger_prototype>
                            <expression>{Template Futur-Tech App StorageCraft:logrt[&quot;C:\Program Files (x86)\StorageCraft\ImageManager\Logs\^\[{#PATH_LOGNAME}\]-\d+\.log$&quot;,&quot;{#VOL}[-\w]+_VirtualBoot_VM| screenshot| VM|_VM_|vboxmanage|[Vv]irtual[ ]*[Bb]o|Hyper-V|^Generated (disks|incremental images)&quot;,,,skip].regexp(^Took screenshot ,{$STORAGECRAFT.COLLAPSE.VIRTUALBOOT.INFO})}=1 and {Template Futur-Tech App StorageCraft:imagemanager.collapse.age[{#MACHINE},{#VOL}].now()}&gt;0&#13;
and {$STORAGECRAFT.COLLAPSE.IGNORE:&quot;{#MACHINE} [{#VOL}]&quot;}=0 &#13;
and {$STORAGECRAFT.COLLAPSE.IGNORE:&quot;{#MACHINE}&quot;}=0</expression>
                            <name>Succeeded VirtualBoot for {#MACHINE_UPPER} [{#VOL}] Collapse in last {$STORAGECRAFT.COLLAPSE.VIRTUALBOOT.INFO} (Verify screenshot sent by email))</name>
                            <opdata>Log: {ITEM.LASTVALUE1}</opdata>
                            <priority>INFO</priority>
                        </trigger_prototype>
                        <trigger_prototype>
                            <expression>{Template Futur-Tech App StorageCraft:logrt[&quot;C:\Program Files (x86)\StorageCraft\ImageManager\Logs\^\[{#PATH_LOGNAME}\]-\d+\.log$&quot;,&quot;{#VOL}[-\w]+_VirtualBoot_VM| screenshot| VM|_VM_|vboxmanage|[Vv]irtual[ ]*[Bb]o|Hyper-V|^Generated (disks|incremental images)&quot;,,,skip].regexp(virtual boot exception: {#VOL}[-\w]+\.spi,#1)}=1 and {Template Futur-Tech App StorageCraft:imagemanager.collapse.age[{#MACHINE},{#VOL}].now()}&gt;0&#13;
and {$STORAGECRAFT.COLLAPSE.IGNORE:&quot;{#MACHINE} [{#VOL}]&quot;}=0 &#13;
and {$STORAGECRAFT.COLLAPSE.IGNORE:&quot;{#MACHINE}&quot;}=0</expression>
                            <recovery_mode>RECOVERY_EXPRESSION</recovery_mode>
                            <recovery_expression>{Template Futur-Tech App StorageCraft:logrt[&quot;C:\Program Files (x86)\StorageCraft\ImageManager\Logs\^\[{#PATH_LOGNAME}\]-\d+\.log$&quot;,&quot;{#VOL}[-\w]+_VirtualBoot_VM| screenshot| VM|_VM_|vboxmanage|[Vv]irtual[ ]*[Bb]o|Hyper-V|^Generated (disks|incremental images)&quot;,,,skip].regexp(^Took screenshot,#1)}=1&#13;
or ({$STORAGECRAFT.COLLAPSE.IGNORE:&quot;{#MACHINE} [{#VOL}]&quot;}=1&#13;
    or {$STORAGECRAFT.COLLAPSE.IGNORE:&quot;{#MACHINE}&quot;}=1)</recovery_expression>
                            <name>VirtualBoot Error for {#MACHINE_UPPER} [{#VOL}] Collapse</name>
                            <opdata>Log: {{ITEM.VALUE}.regsub(&quot;(.*)&quot;, \1)}</opdata>
                            <priority>HIGH</priority>
                            <description>VirtualBoot Error Codes: https://support.storagecraft.com/s/article/verify-backup-images?language=en_US#node_29604</description>
                        </trigger_prototype>
                        <trigger_prototype>
                            <expression>{Template Futur-Tech App StorageCraft:eventlog[Application,,,StorageCraft ImageManager,,,skip].regexp({#PATH_ESC},#1)}=1&#13;
and &#13;
    ({Template Futur-Tech App StorageCraft:eventlog[Application,,,StorageCraft ImageManager,,,skip].regexp([\W]{#VOL}-.+\.spi,#1)}=1 &#13;
    or&#13;
    {Template Futur-Tech App StorageCraft:eventlog[Application,,,StorageCraft ImageManager,,,skip].regexp(_VOL-b\d+-.+\.spi,#1)}=0) &#13;
and {Template Futur-Tech App StorageCraft:imagemanager.collapse.age[{#MACHINE},{#VOL}].last()}&gt;0&#13;
and {Template Futur-Tech App StorageCraft:eventlog[Application,,,StorageCraft ImageManager,,,skip].logseverity()}=2&#13;
and {$STORAGECRAFT.COLLAPSE.IGNORE:&quot;{#MACHINE} [{#VOL}]&quot;}=0 &#13;
and {$STORAGECRAFT.COLLAPSE.IGNORE:&quot;{#MACHINE}&quot;}=0</expression>
                            <recovery_mode>RECOVERY_EXPRESSION</recovery_mode>
                            <recovery_expression>{Template Futur-Tech App StorageCraft:eventlog[Application,,,StorageCraft ImageManager,,,skip].regexp({#PATH_ESC}\\{#VOL}-.+\.spi,#1)}=1&#13;
and {Template Futur-Tech App StorageCraft:eventlog[Application,,,StorageCraft ImageManager,,,skip].logseverity()}=1&#13;
and {Template Futur-Tech App StorageCraft:eventlog[Application,,,StorageCraft ImageManager,,,skip].logeventid(1120)}=1&#13;
or ({$STORAGECRAFT.COLLAPSE.IGNORE:&quot;{#MACHINE} [{#VOL}]&quot;}=1&#13;
    or {$STORAGECRAFT.COLLAPSE.IGNORE:&quot;{#MACHINE}&quot;}=1)</recovery_expression>
                            <name>Warning in ImageManager Event Log for {#MACHINE_UPPER} [{#VOL}]</name>
                            <opdata>Last collapse age: {ITEM.LASTVALUE4}, ImageManager Log: {ITEM.VALUE1}</opdata>
                            <priority>WARNING</priority>
                            <manual_close>YES</manual_close>
                            <dependencies>
                                <dependency>
                                    <name>Critical Error in ImageManager Event Log for {#MACHINE_UPPER} [{#VOL}]</name>
                                    <expression>{Template Futur-Tech App StorageCraft:eventlog[Application,,,StorageCraft ImageManager,,,skip].regexp({#PATH_ESC},#1)}=1&#13;
and &#13;
    ({Template Futur-Tech App StorageCraft:eventlog[Application,,,StorageCraft ImageManager,,,skip].regexp([\W]{#VOL}-.+\.spi,#1)}=1 &#13;
    or&#13;
    {Template Futur-Tech App StorageCraft:eventlog[Application,,,StorageCraft ImageManager,,,skip].regexp(_VOL-b\d+-.+\.spi,#1)}=0) &#13;
and {Template Futur-Tech App StorageCraft:imagemanager.collapse.age[{#MACHINE},{#VOL}].last()}&gt;0&#13;
and {Template Futur-Tech App StorageCraft:eventlog[Application,,,StorageCraft ImageManager,,,skip].logseverity()}=9&#13;
and {$STORAGECRAFT.COLLAPSE.IGNORE:&quot;{#MACHINE} [{#VOL}]&quot;}=0 &#13;
and {$STORAGECRAFT.COLLAPSE.IGNORE:&quot;{#MACHINE}&quot;}=0</expression>
                                    <recovery_expression>{Template Futur-Tech App StorageCraft:eventlog[Application,,,StorageCraft ImageManager,,,skip].regexp({#PATH_ESC}\\{#VOL}-.+\.spi,#1)}=1&#13;
and {Template Futur-Tech App StorageCraft:eventlog[Application,,,StorageCraft ImageManager,,,skip].logseverity()}=1&#13;
and {Template Futur-Tech App StorageCraft:eventlog[Application,,,StorageCraft ImageManager,,,skip].logeventid(1120)}=1&#13;
or ({$STORAGECRAFT.COLLAPSE.IGNORE:&quot;{#MACHINE} [{#VOL}]&quot;}=1&#13;
    or {$STORAGECRAFT.COLLAPSE.IGNORE:&quot;{#MACHINE}&quot;}=1)</recovery_expression>
                                </dependency>
                                <dependency>
                                    <name>Error in ImageManager Event Log for {#MACHINE_UPPER} [{#VOL}]</name>
                                    <expression>{Template Futur-Tech App StorageCraft:eventlog[Application,,,StorageCraft ImageManager,,,skip].regexp({#PATH_ESC},#1)}=1&#13;
and &#13;
    ({Template Futur-Tech App StorageCraft:eventlog[Application,,,StorageCraft ImageManager,,,skip].regexp([\W]{#VOL}-.+\.spi,#1)}=1 &#13;
    or&#13;
    {Template Futur-Tech App StorageCraft:eventlog[Application,,,StorageCraft ImageManager,,,skip].regexp(_VOL-b\d+-.+\.spi,#1)}=0) &#13;
and {Template Futur-Tech App StorageCraft:imagemanager.collapse.age[{#MACHINE},{#VOL}].last()}&gt;0&#13;
and {Template Futur-Tech App StorageCraft:eventlog[Application,,,StorageCraft ImageManager,,,skip].logseverity()}=4&#13;
and {$STORAGECRAFT.COLLAPSE.IGNORE:&quot;{#MACHINE} [{#VOL}]&quot;}=0 &#13;
and {$STORAGECRAFT.COLLAPSE.IGNORE:&quot;{#MACHINE}&quot;}=0</expression>
                                    <recovery_expression>{Template Futur-Tech App StorageCraft:eventlog[Application,,,StorageCraft ImageManager,,,skip].regexp({#PATH_ESC}\\{#VOL}-.+\.spi,#1)}=1&#13;
and {Template Futur-Tech App StorageCraft:eventlog[Application,,,StorageCraft ImageManager,,,skip].logseverity()}=1&#13;
and {Template Futur-Tech App StorageCraft:eventlog[Application,,,StorageCraft ImageManager,,,skip].logeventid(1120)}=1&#13;
or ({$STORAGECRAFT.COLLAPSE.IGNORE:&quot;{#MACHINE} [{#VOL}]&quot;}=1&#13;
    or {$STORAGECRAFT.COLLAPSE.IGNORE:&quot;{#MACHINE}&quot;}=1)</recovery_expression>
                                </dependency>
                            </dependencies>
                        </trigger_prototype>
                    </trigger_prototypes>
                    <master_item>
                        <key>eventlog[Application,,,StorageCraft ImageManager,,,skip]</key>
                    </master_item>
                    <preprocessing>
                        <step>
                            <type>REGEX</type>
                            <params>^(\\\\[^\n\r\\]+(?:.*\\([^\n\r\\]+)\\([^\n\r\\]+)\\ft-backup|.*\\([^\n\r\\]+)\\([^\n\r\\]+)))\\([^\n\r\\]*_VOL-b\d+).+\.spi$
\0</params>
                            <error_handler>DISCARD_VALUE</error_handler>
                        </step>
                        <step>
                            <type>JAVASCRIPT</type>
                            <params>var lld = [];
var row = {};
var matches = /^(\\\\[^\n\r\\]+(?:.*\\([^\n\r\\]+)\\([^\n\r\\]+)\\ft-backup|.*\\([^\n\r\\]+)\\([^\n\r\\]+)))\\([^\n\r\\]*_VOL-b\d+).+\.spi$/gi.exec(value);
row[&quot;{#PATH}&quot;] = matches[1];
row[&quot;{#PATH_ESC}&quot;] = row[&quot;{#PATH}&quot;].replace(/\\/g,'\\\\');
row[&quot;{#PATH_LOGNAME}&quot;] = row[&quot;{#PATH}&quot;].replace(/\\\\/g,'');
row[&quot;{#PATH_LOGNAME}&quot;] = row[&quot;{#PATH}&quot;].replace(/\\\\/g,'');
row[&quot;{#PATH_LOGNAME}&quot;] = row[&quot;{#PATH_LOGNAME}&quot;].replace(/\\/g,'%');
if (matches[2]) {
    row[&quot;{#SITECODE}&quot;] = matches[2];
    row[&quot;{#MACHINE}&quot;] = matches[3];
} else {
    row[&quot;{#SITECODE}&quot;] = matches[4];
    row[&quot;{#MACHINE}&quot;] = matches[5];
}
row[&quot;{#MACHINE_UPPER}&quot;] = row[&quot;{#MACHINE}&quot;].toUpperCase();
row[&quot;{#VOL}&quot;] = matches[6];
lld.push(row);
return JSON.stringify(lld);</params>
                        </step>
                    </preprocessing>
                </discovery_rule>
                <discovery_rule>
                    <name>ShadowProtectSPX Discovery</name>
                    <type>DEPENDENT</type>
                    <key>storagecraft.shadowprotectspx.discovery</key>
                    <delay>0</delay>
                    <item_prototypes>
                        <item_prototype>
                            <name>{#MACHINE_UPPER} Backup [{#TASK}] Age</name>
                            <type>CALCULATED</type>
                            <key>shadowprotectspx.backup.age[{#MACHINE},{#TASK}]</key>
                            <delay>5m</delay>
                            <units>uptime</units>
                            <params>now(&quot;wmi.get[root\cimv2,SELECT TimeGenerated FROM Win32_NTLogEvent WHERE (logfile='Application') AND (SourceName='ShadowProtectSPX') AND (EventCode=3) AND (Message LIKE '%Backup \&quot;{#TASK}\&quot; on {#MACHINE} successfully finished backing up%')]&quot;)-last(&quot;wmi.get[root\cimv2,SELECT TimeGenerated FROM Win32_NTLogEvent WHERE (logfile='Application') AND (SourceName='ShadowProtectSPX') AND (EventCode=3) AND (Message LIKE '%Backup \&quot;{#TASK}\&quot; on {#MACHINE} successfully finished backing up%')]&quot;)</params>
                            <applications>
                                <application>
                                    <name>StorageCraft Dashboard</name>
                                </application>
                                <application>
                                    <name>StorageCraft ShadowProtectSPX</name>
                                </application>
                            </applications>
                            <trigger_prototypes>
                                <trigger_prototype>
                                    <expression>{last()}&gt;{$STORAGECRAFT.BACKUP.CRIT:&quot;{#TASK}&quot;}</expression>
                                    <name>No ShadowProtectSPX Backup of {#MACHINE_UPPER} [{#TASK}] for more than {$STORAGECRAFT.BACKUP.CRIT:&quot;{#TASK}&quot;}</name>
                                    <opdata>Last backup age: {ITEM.LASTVALUE1}</opdata>
                                    <priority>HIGH</priority>
                                </trigger_prototype>
                                <trigger_prototype>
                                    <expression>{last()}&gt;{$STORAGECRAFT.BACKUP.WARN:&quot;{#TASK}&quot;}</expression>
                                    <name>No ShadowProtectSPX Backup of {#MACHINE_UPPER} [{#TASK}] for more than {$STORAGECRAFT.BACKUP.WARN:&quot;{#TASK}&quot;}</name>
                                    <opdata>Last backup age: {ITEM.LASTVALUE1}</opdata>
                                    <priority>WARNING</priority>
                                    <dependencies>
                                        <dependency>
                                            <name>No ShadowProtectSPX Backup of {#MACHINE_UPPER} [{#TASK}] for more than {$STORAGECRAFT.BACKUP.CRIT:&quot;{#TASK}&quot;}</name>
                                            <expression>{Template Futur-Tech App StorageCraft:shadowprotectspx.backup.age[{#MACHINE},{#TASK}].last()}&gt;{$STORAGECRAFT.BACKUP.CRIT:&quot;{#TASK}&quot;}</expression>
                                        </dependency>
                                    </dependencies>
                                </trigger_prototype>
                            </trigger_prototypes>
                        </item_prototype>
                        <item_prototype>
                            <name>{#MACHINE_UPPER} Backup [{#TASK}] Success</name>
                            <type>ZABBIX_ACTIVE</type>
                            <key>wmi.get[root\cimv2,SELECT TimeGenerated FROM Win32_NTLogEvent WHERE (logfile='Application') AND (SourceName='ShadowProtectSPX') AND (EventCode=3) AND (Message LIKE '%Backup &quot;{#TASK}&quot; on {#MACHINE} successfully finished backing up%')]</key>
                            <delay>10m</delay>
                            <units>unixtime</units>
                            <applications>
                                <application>
                                    <name>StorageCraft ShadowProtectSPX</name>
                                </application>
                            </applications>
                            <preprocessing>
                                <step>
                                    <type>JAVASCRIPT</type>
                                    <params>var match = /^(\d+)\.\d+-\d+$/gi.exec(value);
var ts = new Date();

ts.setUTCFullYear(match[1].substring(0,4));
ts.setUTCMonth(match[1].substring(4,6)-1);
ts.setUTCDate(match[1].substring(6,8));
ts.setUTCHours(match[1].substring(8,10));
ts.setUTCMinutes(match[1].substring(10,12));
ts.setUTCSeconds(match[1].substring(12,14));
ts.setUTCMilliseconds(0);

return ts.valueOf() / 1000;</params>
                                </step>
                                <step>
                                    <type>DISCARD_UNCHANGED_HEARTBEAT</type>
                                    <params>1d</params>
                                </step>
                            </preprocessing>
                        </item_prototype>
                    </item_prototypes>
                    <trigger_prototypes>
                        <trigger_prototype>
                            <expression>{Template Futur-Tech App StorageCraft:eventlog[Application,,,ShadowProtectSPX,,,skip].regexp(Backup \&quot;{#TASK}\&quot; on {#MACHINE},#1)}=1&#13;
and {Template Futur-Tech App StorageCraft:shadowprotectspx.backup.age[{#MACHINE},{#TASK}].last()}&gt;0&#13;
and {Template Futur-Tech App StorageCraft:eventlog[Application,,,ShadowProtectSPX,,,skip].logseverity()}=9</expression>
                            <recovery_mode>RECOVERY_EXPRESSION</recovery_mode>
                            <recovery_expression>{Template Futur-Tech App StorageCraft:eventlog[Application,,,ShadowProtectSPX,,,skip].regexp(Backup \&quot;{#TASK}\&quot; on {#MACHINE} successfully finished backing up,#1)}=1 &#13;
and {Template Futur-Tech App StorageCraft:eventlog[Application,,,ShadowProtectSPX,,,skip].logseverity()}=1 &#13;
and {Template Futur-Tech App StorageCraft:eventlog[Application,,,ShadowProtectSPX,,,skip].logeventid(3)}=1</recovery_expression>
                            <name>Critical Error in ShadowProtectSPX Event Log for {#MACHINE_UPPER} [{#TASK}]</name>
                            <opdata>Last backup age: {ITEM.LASTVALUE2} &amp; ShadowProtectSPX Log: {ITEM.VALUE1}</opdata>
                            <priority>HIGH</priority>
                            <manual_close>YES</manual_close>
                        </trigger_prototype>
                        <trigger_prototype>
                            <expression>{Template Futur-Tech App StorageCraft:eventlog[Application,,,ShadowProtectSPX,,,skip].regexp(Backup \&quot;{#TASK}\&quot; on {#MACHINE},#1)}=1&#13;
and {Template Futur-Tech App StorageCraft:shadowprotectspx.backup.age[{#MACHINE},{#TASK}].last()}&gt;0&#13;
and {Template Futur-Tech App StorageCraft:eventlog[Application,,,ShadowProtectSPX,,,skip].logseverity()}=4</expression>
                            <recovery_mode>RECOVERY_EXPRESSION</recovery_mode>
                            <recovery_expression>{Template Futur-Tech App StorageCraft:eventlog[Application,,,ShadowProtectSPX,,,skip].regexp(Backup \&quot;{#TASK}\&quot; on {#MACHINE} successfully finished backing up,#1)}=1 &#13;
and {Template Futur-Tech App StorageCraft:eventlog[Application,,,ShadowProtectSPX,,,skip].logseverity()}=1 &#13;
and {Template Futur-Tech App StorageCraft:eventlog[Application,,,ShadowProtectSPX,,,skip].logeventid(3)}=1</recovery_expression>
                            <name>Error in ShadowProtectSPX Event Log for {#MACHINE_UPPER} [{#TASK}]</name>
                            <opdata>Last backup age: {ITEM.LASTVALUE2} &amp; ShadowProtectSPX Log: {ITEM.VALUE1}</opdata>
                            <priority>AVERAGE</priority>
                            <manual_close>YES</manual_close>
                            <dependencies>
                                <dependency>
                                    <name>Critical Error in ShadowProtectSPX Event Log for {#MACHINE_UPPER} [{#TASK}]</name>
                                    <expression>{Template Futur-Tech App StorageCraft:eventlog[Application,,,ShadowProtectSPX,,,skip].regexp(Backup \&quot;{#TASK}\&quot; on {#MACHINE},#1)}=1&#13;
and {Template Futur-Tech App StorageCraft:shadowprotectspx.backup.age[{#MACHINE},{#TASK}].last()}&gt;0&#13;
and {Template Futur-Tech App StorageCraft:eventlog[Application,,,ShadowProtectSPX,,,skip].logseverity()}=9</expression>
                                    <recovery_expression>{Template Futur-Tech App StorageCraft:eventlog[Application,,,ShadowProtectSPX,,,skip].regexp(Backup \&quot;{#TASK}\&quot; on {#MACHINE} successfully finished backing up,#1)}=1 &#13;
and {Template Futur-Tech App StorageCraft:eventlog[Application,,,ShadowProtectSPX,,,skip].logseverity()}=1 &#13;
and {Template Futur-Tech App StorageCraft:eventlog[Application,,,ShadowProtectSPX,,,skip].logeventid(3)}=1</recovery_expression>
                                </dependency>
                            </dependencies>
                        </trigger_prototype>
                        <trigger_prototype>
                            <expression>{Template Futur-Tech App StorageCraft:eventlog[Application,,,ShadowProtectSPX,,,skip].regexp(Backup \&quot;{#TASK}\&quot; on {#MACHINE},#1)}=1&#13;
and {Template Futur-Tech App StorageCraft:shadowprotectspx.backup.age[{#MACHINE},{#TASK}].last()}&gt;0&#13;
and {Template Futur-Tech App StorageCraft:eventlog[Application,,,ShadowProtectSPX,,,skip].logseverity()}=2</expression>
                            <recovery_mode>RECOVERY_EXPRESSION</recovery_mode>
                            <recovery_expression>{Template Futur-Tech App StorageCraft:eventlog[Application,,,ShadowProtectSPX,,,skip].regexp(Backup \&quot;{#TASK}\&quot; on {#MACHINE} successfully finished backing up,#1)}=1 &#13;
and {Template Futur-Tech App StorageCraft:eventlog[Application,,,ShadowProtectSPX,,,skip].logseverity()}=1 &#13;
and {Template Futur-Tech App StorageCraft:eventlog[Application,,,ShadowProtectSPX,,,skip].logeventid(3)}=1</recovery_expression>
                            <name>Warning in ShadowProtectSPX Event Log for {#MACHINE_UPPER} [{#TASK}]</name>
                            <opdata>Last backup age: {ITEM.LASTVALUE2} &amp; ShadowProtectSPX Log: {ITEM.VALUE1}</opdata>
                            <priority>WARNING</priority>
                            <manual_close>YES</manual_close>
                            <dependencies>
                                <dependency>
                                    <name>Critical Error in ShadowProtectSPX Event Log for {#MACHINE_UPPER} [{#TASK}]</name>
                                    <expression>{Template Futur-Tech App StorageCraft:eventlog[Application,,,ShadowProtectSPX,,,skip].regexp(Backup \&quot;{#TASK}\&quot; on {#MACHINE},#1)}=1&#13;
and {Template Futur-Tech App StorageCraft:shadowprotectspx.backup.age[{#MACHINE},{#TASK}].last()}&gt;0&#13;
and {Template Futur-Tech App StorageCraft:eventlog[Application,,,ShadowProtectSPX,,,skip].logseverity()}=9</expression>
                                    <recovery_expression>{Template Futur-Tech App StorageCraft:eventlog[Application,,,ShadowProtectSPX,,,skip].regexp(Backup \&quot;{#TASK}\&quot; on {#MACHINE} successfully finished backing up,#1)}=1 &#13;
and {Template Futur-Tech App StorageCraft:eventlog[Application,,,ShadowProtectSPX,,,skip].logseverity()}=1 &#13;
and {Template Futur-Tech App StorageCraft:eventlog[Application,,,ShadowProtectSPX,,,skip].logeventid(3)}=1</recovery_expression>
                                </dependency>
                                <dependency>
                                    <name>Error in ShadowProtectSPX Event Log for {#MACHINE_UPPER} [{#TASK}]</name>
                                    <expression>{Template Futur-Tech App StorageCraft:eventlog[Application,,,ShadowProtectSPX,,,skip].regexp(Backup \&quot;{#TASK}\&quot; on {#MACHINE},#1)}=1&#13;
and {Template Futur-Tech App StorageCraft:shadowprotectspx.backup.age[{#MACHINE},{#TASK}].last()}&gt;0&#13;
and {Template Futur-Tech App StorageCraft:eventlog[Application,,,ShadowProtectSPX,,,skip].logseverity()}=4</expression>
                                    <recovery_expression>{Template Futur-Tech App StorageCraft:eventlog[Application,,,ShadowProtectSPX,,,skip].regexp(Backup \&quot;{#TASK}\&quot; on {#MACHINE} successfully finished backing up,#1)}=1 &#13;
and {Template Futur-Tech App StorageCraft:eventlog[Application,,,ShadowProtectSPX,,,skip].logseverity()}=1 &#13;
and {Template Futur-Tech App StorageCraft:eventlog[Application,,,ShadowProtectSPX,,,skip].logeventid(3)}=1</recovery_expression>
                                </dependency>
                            </dependencies>
                        </trigger_prototype>
                    </trigger_prototypes>
                    <master_item>
                        <key>eventlog[Application,,,ShadowProtectSPX,,,skip]</key>
                    </master_item>
                    <preprocessing>
                        <step>
                            <type>REGEX</type>
                            <params>Backup &quot;([^&quot;]+)&quot; on (.+) successfully finished backing up
\0</params>
                        </step>
                        <step>
                            <type>JAVASCRIPT</type>
                            <params>var lld = [];
var row = {};
var matches = /Backup &quot;([^&quot;]+)&quot; on (.+) successfully finished backing up/gi.exec(value);
row[&quot;{#TASK}&quot;] = matches[1];
row[&quot;{#MACHINE}&quot;] = matches[2];
row[&quot;{#MACHINE_UPPER}&quot;] = row[&quot;{#MACHINE}&quot;].toUpperCase();
lld.push(row);
return JSON.stringify(lld);</params>
                        </step>
                    </preprocessing>
                </discovery_rule>
            </discovery_rules>
            <macros>
                <macro>
                    <macro>{$STORAGECRAFT.BACKUP.CRIT}</macro>
                    <value>5d</value>
                    <description>Critical max age for latest successful Backup</description>
                </macro>
                <macro>
                    <macro>{$STORAGECRAFT.BACKUP.WARN}</macro>
                    <value>3d</value>
                    <description>Warning max age for latest successful Backup</description>
                </macro>
                <macro>
                    <macro>{$STORAGECRAFT.COLLAPSE.CHKDSK}</macro>
                    <value>1</value>
                    <description>By default, CheckDisk trigger is activated</description>
                </macro>
                <macro>
                    <macro>{$STORAGECRAFT.COLLAPSE.CHKDSK.CRIT}</macro>
                    <value>10d</value>
                    <description>Max age for latest successful CHKDSK on Collapse</description>
                </macro>
                <macro>
                    <macro>{$STORAGECRAFT.COLLAPSE.CHKDSK.INFO}</macro>
                    <value>12h</value>
                    <description>Show info of successful CHKDSK during this time</description>
                </macro>
                <macro>
                    <macro>{$STORAGECRAFT.COLLAPSE.CRIT}</macro>
                    <value>5d</value>
                    <description>Critical max age for latest successful Collapse</description>
                </macro>
                <macro>
                    <macro>{$STORAGECRAFT.COLLAPSE.IGNORE}</macro>
                    <value>0</value>
                    <description>By default, triggers for ImageManager are activated. Set to 1 for disable all the triggers.</description>
                </macro>
                <macro>
                    <macro>{$STORAGECRAFT.COLLAPSE.IGNORE:&quot;DEVT-ST001 [C_VOL-b001]&quot;}</macro>
                    <value>1</value>
                    <description>Exemple of macro for disabling triggers for a specific chain of a machine.</description>
                </macro>
                <macro>
                    <macro>{$STORAGECRAFT.COLLAPSE.IGNORE:&quot;DEVT-ST001&quot;}</macro>
                    <value>1</value>
                    <description>Exemple of macro for disabling triggers for all the chains of a machine.</description>
                </macro>
                <macro>
                    <macro>{$STORAGECRAFT.COLLAPSE.VIRTUALBOOT}</macro>
                    <value>0</value>
                    <description>By default, VirtualBoot check is not activated on ImageManager</description>
                </macro>
                <macro>
                    <macro>{$STORAGECRAFT.COLLAPSE.VIRTUALBOOT.CRIT}</macro>
                    <value>40d</value>
                    <description>Max age for latest successful VirtualBoot on Collapse</description>
                </macro>
                <macro>
                    <macro>{$STORAGECRAFT.COLLAPSE.VIRTUALBOOT.INFO}</macro>
                    <value>1d</value>
                    <description>Show info of successful VirtualBoot during this time</description>
                </macro>
                <macro>
                    <macro>{$STORAGECRAFT.COLLAPSE.WARN}</macro>
                    <value>3d</value>
                    <description>Warning max age for latest successful Collapse</description>
                </macro>
            </macros>
        </template>
    </templates>
</zabbix_export>
